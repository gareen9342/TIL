# 브라우저의 렌더링 원리

## 브라우저의 기능

브라우저의 주요 기능 사용자가 선택한 자원을 서버에 요청하고 브라우저에 표시해준다.
보통은 HTML 문서지만 PDF나 이미지 또는 다른 형태일 수 있다.

자원의 주소는  URI에 의해 정해진다. 

## 브라우저의 기본 구조

1. 사용자 인터페이스 
2. 브라우저 엔진 : UI와 렌더링 엔진 사이의 동작을 제어
3. 렌더링 엔진 : 요청한 콘텐츠를 표시
4. 통신 : HTTP 요청과 같은 네트워크 호출에 사용됨. 이것은 플랫폼 독립적인 인터페이스이고 각 플랫폼 하부에서 실행됨.
5. UI백엔드 : 플랫폼에서 명시하지 않은 일반적인 인터페이스로서, OS사용자 인터페이스 체계를 사용
6. 자바스크립트 해석기
7. 자료저장소 

→ 크롬의 경우 각 탭마다 별도의 렌더링 엔진 인스턴스를 유지하고, 각 탭은 독립적인 프로세스로 처리된다. 즉 디버깅 하기 너무 편하다! (라이트 하우스도 지원이 되기도 하고.)

## 렌더링 엔진들

파이어폭스, 크롬, 사파리는 두 가지 렌더링 엔진으로 제작되었다.

파이어폭스 : Gecko 사파리, 크롬 : Webkit

## 진행과정

1. HTML파싱 후, DOM(Document Object Model) 트리 구축
콘텐츠 트리 내부에서 태그를 DOM노드로 변환해준다. 
2. CSS 파싱 후, CSSOM(CSS Object Model) 트리 구축
3. Javascript 실행
    - HTML 중간에 스크립트 있을 시 HTML 파싱 중단된다.
4. DOM 과 CSSOM 을 조합하여 렌더트리(Render Tree) 구축 

     - display none 은 렌더트리로 구축되지 않는다.

5. 뷰포트 기반으로 렌더트리의 각 노드가 가지는 정확한 위치와 크기 계산
6. 계산한 위치/ 크기를 기반으로 화면에 그림

## 파싱과 DOM 트리 구축

문서 파싱 : 브라우저가 코드를 이해하고 사용할 수 있는 구조로 변환하는 것을 의미

파싱 결과는 보통 문서 구조를 나타내는 노드 트리인데 파싱트리 또는 문법 트리라고 부른다.

HTML 파싱 : HTML파서는 마크업을 파싱 트리로 변환한다.

## Layout

레이아웃 단계는 브라우저의 Viewport 내에서 각 노드들의 위치와 크기를 계산한다.

뷰포트란? 뷰가 그려지는 브라우저의 영역, 크기를 말한다. 

때문에 브라우저의 창의 크기가 달라질 때마다 변경되고, 뷰포트의 크기가 달라지는 경우 계산을 다시 해야 한다.