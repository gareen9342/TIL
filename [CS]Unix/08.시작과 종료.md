# 리눅스 시작과 종료

시스템의 부팅과 종료는 실행 중인 여러 다양한 서비스와 프로세스를 함께 시작시키고 종료시키는 과정이다. 
이런 과정을 부팅, 또는 부트스트래핑이라고 함

운영체제를 부팅하려면 부트프로그램이 필요함 -> 하드디스크로부터 운영체제를 메모리로 적재시키는 프로그램 ( 부트로더, 부트스트랩로더 라고 부르는 프로그램이다. )

이런 부트 로더는 컴퓨터가 시작될 때 수행되는 첫 번쨰 프로그램으로 운영체제를 메모리에 적재하여 실행시키며, 운영체제에 시스템의 제어를 넘겨주는 일을 수행함.
부팅 가능한 파티션을 찾고, 운영체제 커널을 찾아 로드하고 실행시킨다. 

## 리눅스의 부팅
서버용 리눅스를 사용시에는 특별히 시스템을 점검해야 하는 상황이 아니면 시스템을 종료할 일이 없음.. 
과거에는 부트로더 프로그램으로 LILO -> 최근에는 GNU 의 GRUB2

리눅스 시스템의 전형적인 부팅 절차
1. 머신 BIOS 또는 부트 펌웨어가 부트 로더를 로드하고 실행시킨다. 
2. 부트 로더가 디스크에서 커널 이미지를 찾아 메모리에 로드하고 시작시킴
3. 커널이 디바이스를 찾고 디바이스 드라이버를 로드
4. 커널이 루트 파일 시스템을 마운트
5. 커널은 (sbin/init)프로그램을 시작시키고 제어를 넘김
6. 해당 프로그램이 시스템 초기화 작업을 실행
7. 로그인

## 커널의 로딩과 실행 

1. 부트로더가 커널이미지(실행파일을 찾아 메모리에 적재() 여기까지가 부트로더의 역할)
2. 커널이 메모리에 로드되면, 커널이 실행된다.
3. 커널 내부의 기능중 현재 시스템에 설치된 하드웨어를 하나씩 인식하고 점검하는 기능 실행
4. 이는 하드웨어 전반을 점검하고 초기화
5. 루트 파일 시스템을 읽기 전용으로 마운트
6. 디스크 검사 후 쓰기 가능 형태로 다시 마운트
7. 프린팅, 로그인과 같은 기능은 데몬프로세스로 구성하여 수행

### 초기화 데몬

과거의 전통적 데몬에서는 단순히 런레벨에만 기초하여 순차적으로 서비스를 실행시키는 방법으로 비효율적이었다 (런레벨 = 부팅모드)

이러한 단점을 극복하기 위해 만든 것이 이벤트 기반으로 작동하는 데몬을 만드는 것    
-> 업스타트 데몬, systemd 데몬

사용자 환경을 준비하기 위해 /sbin/init 프로그램을 실행시켜 초기화 작업을 한다.     
이 프로그램을 init 프로세스라고 하는데 나머지 부팅 과정을 담당하며 최종적으로 사용자 환경을 준비하는 기능을 한다.     
이 init프로세스는 커널이 가장 처음 실행시키는 사용자 프로세스이며 PID 1번을 가지는 특별한 프로세스 이고, 커널 프로세스를 제외한 모든 사용자 프로세스의 조상 프로세스가 된다    

/etc/init 에 있는 job 설정 파일(확장자 -> .conf)을 읽어 들이고 이벤트를 감시한다.    

이벤트는 예를 들면 런레벨의 변경, 특정 job의 시작이나 종료, USB 장비의 부착 등이 있음.    

예를 들면, 런레벨이 0~6 사이에 하나로 시작되는 이벤트가 init에 전달되면,    
데몬이 /etx/tc.d/rc 3(런레벨 3이라고 가정한다면)을 실행    
그리고 해당 디렉터리에 존재하는 스크립트 중 이름이 K로 시작하는 스크립트를 먼저 실행하여 해당 서비스를 시작시킨다.   
(실제 스크립트는 아니고 실제 스크립트 파일의 심벌릭링크다. )

### 런레벨

서비스의 실행을 단계별로 구분하여 적용하는 개념이다. 
OS마다 차이가 있지만, 대부분의 리눅스 배포판이 0~6 사이의 일곱 가지 런레벨 사용한다. 

런레벨을 변경 : `telinit runlevel`
ex ) `telinit 0` : 종료

### 서비스의 실행 

어떤 서비스가 실행중인지 상태를 확인하고, 삭제 비활성화 등을 할 수 있다. 

`chkconfig [--list] [service]`

chkconfig or chkconfig --list 의 실행으로 모든 서비스 각각에 대해 각 런레벨에서의 활성화 여부를 알려줌 

### 시스템 종료

시스템을 안전하게 종료하는 명령으로는 shutdown 

접속 중인 모든 사용자에게 시스템의 종료를 알리고 일반 사용자의 로그인 시도를 차단한 후 시스템을 종료하거나 시스템을 재부팅한다. 

여유시간을 줄 수도 있고, 경고메시지 기간과 내용을 설정할 수도 있다. 

수행과정을 요약하면

1. init 프로그램이 모든 프로세스에 시스템 종료를 알린다. 
2. 프로세스가 스스로 종료하라고 TERM 시그널을 보냄 
3. 종료하지 않는 프로세스에 강제 종료를 위한 KILL 시그널을 보낸다. 
4. 파일 시스템을 잠그고 셧다운을 준비
5. 루트 팦일 시스템을 제외한 모든 파일 시스템 언마운트
6. 루트 파일 시스템을 읽기 전용으로 다시 마운트 
7. sync 프로그램을 이용하여 버퍼 데이터를 파일 시스템에 기록
8. 커널에 종료 또는 재부팅할 것을 알림. 