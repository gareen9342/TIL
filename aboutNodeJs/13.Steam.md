# Stream
출처 : Node.js 디자인패턴 바이블
> 모든 스트림은 스트림 코어 모듈에서 사용할 수 있는 네 가지 기본 추상 클래스 중 하나의 구현.

1. Readable
2. Writable
3. Duplex
4. Transform


> 각 스트림 클래스는 EventEmitter의 인스턴스이기도 하다.    


- 읽기 가능한 스트림이 읽리를 마쳤을 때 end   
- 쓰기를 마쳤을 때 finish   
- 무언가 잘못되었을 때 error   
와 같은 유형의 이벤트를 생성 

바이너리 데이터뿐만 아니라 거의 모든 자바스크립트의 값들을 처리할 수 있다. 

## Readable Stream

> 두 가지 모드를 가진다. non-flowing(paused), flowing

### non-flowing

> Stream 내부에 읽을 수 있는 데이터가 있는지 나타내는 이벤트가 있다.    
> 그리고 이것이 리스너와 연결하는 작업을 해야하고 루프에서 내부 버퍼가 비워질 때까지 데이터를 계속 읽는다.    
> 내부 버퍼에서는 동기적으로 데이터를 읽어 데이터 청크 (하나의 읽어진 단위)를 반환하는 read() 함수를 이용하여 수행된다.    

예시 
read-stdin.js
```javascript
process.stdin
.on('readable', () => {
    let chunk
    console.log('New Data available')
    while((chunk = process.stdin.read()) !== null){
        console.log(`Chunk read (${chunk.length} bytes : ${chunk.toString()}`)
    }
})
.on('end', ()=> console.log('end stream'))
```

- read()    
: 기본적으로 바이너리 모드일 경우는 Buffer 객체 리턴, 아무것도 없으면 null 리턴


### flowing

> 데이터 이벤트에 리너를 연결하는 것, 이렇게 하면 스트림이 flowing 모드를 사용하도록 전환된다. 
> 데이터가 오자마자 바로 리스너로 연결된다. 

```javascript
process.stdin
.on('data', (chunk) => {
    // do something with chunk
})
.on('end', () => {
    //end
})
```

### 비동기 

>Readanle Stream은 비동기 반복자 (Iterator)이기도 하다.

```javascript
async function main(){
    for await (const chunk of process.stdin){
        //do something
    }
    console.log('end of steam')
}

main()

```

